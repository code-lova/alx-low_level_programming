Nexted loop and more functions
